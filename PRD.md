# Product Requirements Document (PRD) - dz-vehicle-v2

## 1. 项目概览 (Project Overview)
`dz-vehicle-v2` 是一个无人值守的车辆资产管理系统，旨在简化车辆钥匙和加油卡的借还流程。系统专注于简洁性、安全性，并为中文用户提供本地化体验。

## 2. 目标受众 (Target Audience)
- **员工**: 需要借用和归还车辆及加油卡的内部人员。
- **管理员**: 负责维护资产清单、用户白名单、系统安全及车辆状态监控的人员。

## 3. 核心功能 (Core Features)

### 3.1 无人值守借还 (Unattended Pickup & Return)
- **资产分类**: 资产分为“车辆”（以钥匙代表）和“加油卡”。
- **简化选择**: 用户可从清单中选择一辆车和/或一张加油卡。
- **批量归还**: 用户可通过单一操作归还当前持有的所有资产。
- **工作流限制**: 用户每次借用限一辆车和一张卡。
- **持久密码显示**: 用于开启储物柜的密码直接在 UI 中以绿色边框显示，不使用弹窗。
- **自动失效**: 密码显示在 2 小时后自动消失，保持界面整洁并增强安全性。
- **刷新持久化**: 显示的密码在页面刷新或浏览器重启后依然保留，直到 2 小时到期。

### 3.2 管理功能 (Administrative Management)
- **用户白名单**: 管理授权使用系统的用户名单。
- **批量导入**: 支持从文本文件高效批量导入授权用户，具备原子验证和重复检测功能。
- **资产清单**: 添加、更新和删除车辆及加油卡。
- **OTP 池管理**: 为安全操作生成一次性密码（OTP）。
- **批量 OTP 播种**: 支持从文件批量导入 8 位 OTP，自动跳过重复项。
- **借出监控**: 通过 CLI 和 Dashboard 实时查看活动借出记录及其持有人。
- **借还记录透明化**: 专用的公共“领取记录”(Loan Records) 面板，追踪最近 200 条记录，支持 Excel 风格过滤与分页。
- **CLI & API 访问**: 通过命令行和 REST API 提供完整的管理控制。

### 3.3 安全验证 (Security Validation)
- **管理员密钥**: 管理操作由强制性的 `ADMIN_SECRET` 保护。
- **环境配置**: 支持 `.env` 文件安全管理密钥和配置。

### 3.4 中文本地化 (Chinese Localization)
- **本地化 UI**: 前端界面完全使用简体中文。
- **现代排版**: 针对中文优化的字体栈，提升易读性。

### 3.5 车辆保养与合规追踪 (Vehicle Maintenance & Compliance Tracking)
- **保养记录**: 追踪最后一次保养的日期和里程。
- **合规监控**: 管理年检日期和保险到期日期。
- **视觉警报**: 管理界面中，针对保养过期（>6个月）或合规到期（<30天）的车辆，使用橙色背景 (`warning-row`) 和 ⚠️ 图标高亮。
- **自动通知**: 每周向管理员发送包含所有车辆预警摘要的邮件。
- **管理面板**: 专用“车辆信息”(Vehicle Information) 面板，供管理员安全更新记录。

## 4. 技术栈 (Technical Stack)
- **后端 (Backend)**:
  - 语言: Python 3.10+
  - 框架: FastAPI (API), Typer (CLI)
  - 数据库: SQLite (SQLAlchemy 2.0+)
  - 测试: Pytest (严格执行 TDD)
- **前端 (Frontend)**:
  - 框架: Vue 3.5+ (Composition API) + TypeScript 5.9
  - UI 库: Element Plus
  - 国际化: Vue-i18n
  - 构建工具: Vite 7+

## 5. 成功标准 (Success Criteria)
- **效率提升**: 简化 UI 后，用户完成借还资产的时间显著减少。
- **数据一致性**: 资产状态更新实现 100% 原子化。
- **安全性**: 没有任何未经授权的人员能访问管理端点。
- **用户满意度**: 对本地化中文界面的积极反馈。
